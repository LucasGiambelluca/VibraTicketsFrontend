# ğŸ¯ FLUJO VISUAL DE PAGO - ExplicaciÃ³n Completa

## ğŸ–¼ï¸ PANTALLA INICIAL DE CHECKOUT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ« Checkout - Completa tu compra                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚ ğŸ“‹ Resumen de compra                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚ â”‚ â€¢ 2 x General Admission    â”‚                            â”‚
â”‚ â”‚ â€¢ 1 x VIP                  â”‚                            â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                            â”‚
â”‚ â”‚ Subtotal:      $10,000     â”‚                            â”‚
â”‚ â”‚ Cargos:        $1,500      â”‚                            â”‚
â”‚ â”‚ TOTAL:         $11,500     â”‚                            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                            â”‚
â”‚ ğŸ’³ InformaciÃ³n de pago                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚ â”‚ Nombre:     [Juan        ] â”‚                            â”‚
â”‚ â”‚ Apellido:   [PÃ©rez       ] â”‚                            â”‚
â”‚ â”‚ Email:      [juan@test.com]â”‚                            â”‚
â”‚ â”‚ TelÃ©fono:   (11) [12345678]â”‚                            â”‚
â”‚ â”‚ DNI:        [12345678     ]â”‚                            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                            â”‚
â”‚ [Volver]                                                   â”‚
â”‚                                                            â”‚
â”‚ ğŸ”’ [Pagar $11,500]  â† BOTÃ“N AZUL (FLUJO REAL)            â”‚
â”‚                                                            â”‚
â”‚ ğŸ§ª [Simular Pago (Testing)]  â† BOTÃ“N NARANJA (SIMULACIÃ“N)â”‚
â”‚ ğŸ’¡ Si el simulador falla, usa el pago real con tarjeta... â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”µ FLUJO 1: PAGO REAL (BotÃ³n azul "Pagar $11,500")

### PASO 1: Haces click en el botÃ³n azul

```
Usuario hace click â†’ ğŸ”’ [Pagar $11,500]
```

### PASO 2: Se crea la preferencia (loading...)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â³ Creando preferencia de pago...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PASO 3: Aparece el botÃ³n de MercadoPago

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”’ [Pagar $11,500] â† DISABLED (ya no podÃ©s hacer click)  â”‚
â”‚                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ âœ… Completa tu pago con Mercado Pago               â”‚   â”‚
â”‚ â”‚ Listo, elegÃ­ tu medio de pago y finalizÃ¡ la compra â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚                                                     â”‚   â”‚
â”‚ â”‚        ğŸ’³ MERCADO PAGO                             â”‚   â”‚
â”‚ â”‚                                                     â”‚   â”‚
â”‚ â”‚     [Pagar con Mercado Pago]  â† NUEVO BOTÃ“N       â”‚   â”‚
â”‚ â”‚                                                     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PASO 4: Haces click en el botÃ³n de MercadoPago

```
Usuario hace click â†’ [Pagar con Mercado Pago]
```

### PASO 5a: Se abre un MODAL (Wallet Brick)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’³ Mercado Pago                              [X]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚ Total a pagar: $11,500                              â”‚
â”‚                                                      â”‚
â”‚ ğŸ¨ ElegÃ­ tu medio de pago:                          â”‚
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ â— Tarjeta de crÃ©dito                     â”‚       â”‚
â”‚ â”‚   â—‹ Visa                                 â”‚       â”‚
â”‚ â”‚   â—‹ Mastercard                           â”‚       â”‚
â”‚ â”‚   â—‹ American Express                     â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                      â”‚
â”‚ NÃºmero de tarjeta:                                  â”‚
â”‚ [5031 7557 3453 0604]  â† AQUÃ ingresas la tarjeta  â”‚
â”‚                                                      â”‚
â”‚ Vencimiento:       CVV:                             â”‚
â”‚ [11/25]           [123]                             â”‚
â”‚                                                      â”‚
â”‚ Nombre en la tarjeta:                               â”‚
â”‚ [APRO]                                              â”‚
â”‚                                                      â”‚
â”‚                                  [Pagar $11,500]    â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PASO 5b: O se redirige a MercadoPago (RedirecciÃ³n completa)

```
Tu sitio (localhost:5173)
    â†“
Redirige a
    â†“
www.mercadopago.com.ar/checkout/...
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’³ Mercado Pago                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ EstÃ¡s pagando $11,500 a VibraTicket                â”‚
â”‚                                                      â”‚
â”‚ NÃºmero de tarjeta:                                  â”‚
â”‚ [____-____-____-____]  â† AQUÃ ingresas la tarjeta  â”‚
â”‚                                                      â”‚
â”‚ Vencimiento: [__/__]    CVV: [___]                 â”‚
â”‚                                                      â”‚
â”‚ Nombre: [________________]                          â”‚
â”‚                                                      â”‚
â”‚ [Pagar]                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PASO 6: MercadoPago procesa el pago

```
â³ Procesando pago...
```

### PASO 7: Redirige a tu sitio con el resultado

```
www.mercadopago.com.ar
    â†“
Redirige de vuelta a
    â†“
localhost:5173/payment/success?holdId=123
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Â¡Pago exitoso!                                   â”‚
â”‚                                                      â”‚
â”‚ Tu compra fue procesada correctamente.              â”‚
â”‚ RecibirÃ¡s tus tickets por email.                   â”‚
â”‚                                                      â”‚
â”‚ ğŸ« Tickets generados: 3                             â”‚
â”‚                                                      â”‚
â”‚ [Ver mis tickets]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŸ  FLUJO 2: SIMULACIÃ“N (BotÃ³n naranja "ğŸ§ª Simular Pago")

### PASO 1: Haces click en el botÃ³n naranja

```
Usuario hace click â†’ ğŸ§ª [Simular Pago (Testing)]
```

### PASO 2: Backend simula automÃ¡ticamente

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â³ Simulando pago...                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš ï¸ NO HAY PASO 3, 4, 5... Va directo al resultado.**

### PASO 3: Redirige al Ã©xito

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Â¡Pago simulado exitoso!                          â”‚
â”‚                                                      â”‚
â”‚ (Esta fue una simulaciÃ³n, no se procesÃ³ tarjeta)   â”‚
â”‚                                                      â”‚
â”‚ ğŸ« Tickets generados: 3                             â”‚
â”‚                                                      â”‚
â”‚ [Ver mis tickets]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â“ Â¿POR QUÃ‰ NO VES EL FORMULARIO DE TARJETA?

### Causa 1: EstÃ¡s usando el SIMULADOR (botÃ³n naranja)

**SÃ­ntoma:**
- Hiciste click en "ğŸ§ª Simular Pago (Testing)"
- NO apareciÃ³ ningÃºn formulario de tarjeta
- Fue directo a success o dio error

**ExplicaciÃ³n:**
- âœ… **ES CORRECTO** que no pida tarjeta
- El simulador NO usa MercadoPago
- Es solo para testing rÃ¡pido

**SoluciÃ³n:**
- Usa el botÃ³n azul "Pagar $XXX" para el flujo real

---

### Causa 2: El SDK de MercadoPago no se cargÃ³

**SÃ­ntoma:**
- Hiciste click en "Pagar $11,500" (botÃ³n azul)
- NO apareciÃ³ el botÃ³n de MercadoPago
- Nada pasÃ³, o dio error

**VerificaciÃ³n:**
1. Abrir consola (F12)
2. Escribir: `window.MercadoPago`
3. Si dice `undefined` â†’ El SDK no se cargÃ³

**Causas:**
- âŒ Falta el script en `index.html`
- âŒ Public Key incorrecta
- âŒ Error de red

**SoluciÃ³n:**
Verificar que en `index.html` estÃ¡:
```html
<script src="https://sdk.mercadopago.com/js/v2"></script>
```

---

### Causa 3: La preferencia no se creÃ³

**SÃ­ntoma:**
- Hiciste click en "Pagar $11,500"
- Viste mensaje "Creando preferencia..."
- Luego error o no pasÃ³ nada

**VerificaciÃ³n:**
1. Abrir Network tab (F12)
2. Buscar: `POST /api/payments/create-preference`
3. Ver el status code

**Posibles resultados:**
- âœ… **200 OK** â†’ La preferencia se creÃ³, pero el botÃ³n no aparece
- âŒ **404** â†’ Endpoint no existe
- âŒ **400/500** â†’ Error en el backend
- âŒ **No aparece** â†’ El request no se enviÃ³

**SoluciÃ³n segÃºn el error:**
- 404: Verificar ruta en el backend
- 400: Verificar que el backend acepta `holdId`
- 500: Ver logs del backend
- No aparece: Verificar que el botÃ³n estÃ¡ llamando la funciÃ³n

---

### Causa 4: Se redirige pero no lo notas

**SÃ­ntoma:**
- Hiciste click en "Pagar $11,500"
- La pÃ¡gina "saltÃ³" pero volviÃ³ rÃ¡pido
- O se quedÃ³ en blanco

**VerificaciÃ³n:**
1. Network tab (F12)
2. Ver si hay una redirecciÃ³n a `mercadopago.com.ar`

**Causa:**
- El backend estÃ¡ usando **init_point** en vez de **preferenceId**
- Esto causa redirecciÃ³n completa en vez de modal

**SoluciÃ³n:**
- Es normal, es la OpciÃ³n B (redirecciÃ³n)
- DeberÃ­as ver la pÃ¡gina de MercadoPago
- Si vuelve rÃ¡pido, puede haber un error en la URL

---

## ğŸ§ª CÃ“MO PROBAR CADA FLUJO

### Para probar el SIMULADOR:

1. Ir a `/checkout/:holdId`
2. **NO llenar el formulario** (opcional)
3. Scroll hasta abajo
4. Click en **ğŸ§ª [Simular Pago (Testing)]** (botÃ³n naranja)
5. DeberÃ­a redirigir a success inmediatamente

### Para probar el FLUJO REAL:

1. Ir a `/checkout/:holdId`
2. **SÃ llenar el formulario:**
   - Nombre: Juan
   - Apellido: PÃ©rez
   - Email: test@example.com
   - TelÃ©fono: 12345678
   - DNI: 12345678
3. Click en **ğŸ”’ [Pagar $XXX]** (botÃ³n azul)
4. Esperar que aparezca el botÃ³n de MercadoPago
5. Click en el botÃ³n de MercadoPago
6. Ingresar tarjeta de prueba:
   - **NÃºmero:** 5031 7557 3453 0604
   - **Vencimiento:** 11/25
   - **CVV:** 123
   - **Nombre:** APRO
7. Click en "Pagar"
8. DeberÃ­a redirigir a success

---

## ğŸ“ DEBUGGING

**CuÃ©ntame:**

1. Â¿CuÃ¡l botÃ³n estÃ¡s usando?
   - [ ] ğŸ§ª Simular Pago (Testing) - naranja
   - [ ] ğŸ”’ Pagar $XXX - azul

2. Â¿QuÃ© pasa cuando haces click?
   - [ ] No pasa nada
   - [ ] Aparece mensaje "Creando preferencia..."
   - [ ] Aparece botÃ³n de MercadoPago
   - [ ] Se redirige a otra pÃ¡gina
   - [ ] Da error

3. Â¿Ves algÃºn error en consola (F12)?

4. Â¿QuÃ© aparece en Network tab cuando haces click?

Con esa info puedo ayudarte mejor. ğŸš€
